<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GX71 空ぶかし</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#wrap{text-align:center;}
#pedal{
  width:220px;
  height:220px;
  border-radius:50%;
  background:#c00;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  user-select:none;
}
#rpm{margin-top:20px;opacity:0.8;}
</style>
</head>
<body>

<div id="wrap">
  <h1>GX71 マークII</h1>
  <div id="pedal">ACCEL</div>
  <div id="rpm">RPM: 800</div>
</div>

<audio id="engine"
  src="sounds/video-output-E1E478D7-8EF9-4800-9467-5685FCF4DD36.mp3"
  loop
></audio>

<script>
const engine = document.getElementById("engine");
const pedal = document.getElementById("pedal");
const rpmText = document.getElementById("rpm");

let rpm = 800;
let accel = false;
let started = false;

// Safari対策：最初のタップで一生再生
function start(){
  if(started) return;
  engine.volume = 0.0;
  engine.playbackRate = 0.9;
  engine.play();
  started = true;
}

// 押した瞬間（キック）
function press(){
  start();
  accel = true;

  // 空ぶかしの「初動」
  engine.volume = 1.0;
  engine.playbackRate = 1.25;
}

// 離した瞬間（アフター）
function release(){
  accel = false;

  // 一瞬だけ鳴り返す
  engine.volume = 0.8;
}

pedal.addEventListener("touchstart", press);
pedal.addEventListener("mousedown", press);
pedal.addEventListener("touchend", release);
pedal.addEventListener("mouseup", release);

// 慣性付き回転制御
setInterval(()=>{
  if(accel){
    // 上昇：旧車らしく重い
    rpm += 60;
    if(rpm > 4800) rpm = 4800;
  }else{
    // 落ち：少し粘る
    rpm -= 90;
    if(rpm < 800) rpm = 800;
  }

  // ピッチは回転に追従（急変しない）
  const targetRate = 0.7 + (rpm / 6500);
  engine.playbackRate += (targetRate - engine.playbackRate) * 0.15;

  // 音量も自然に戻す
  const targetVol = accel ? 1.0 : 0.2;
  engine.volume += (targetVol - engine.volume) * 0.2;

  rpmText.textContent = "RPM: " + rpm;
}, 50);
</script>

</body>
</html>
