<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GX71 空ぶかし</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#wrap{text-align:center;}
#pedal{
  width:220px;
  height:220px;
  border-radius:50%;
  background:#c00;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  user-select:none;
}
#rpm{margin-top:20px;opacity:0.8;}
</style>
</head>
<body>

<div id="wrap">
  <h1>GX71 マークII</h1>
  <div id="pedal">ACCEL</div>
  <div id="rpm">RPM: 800</div>
</div>

<audio id="engine"
  src="sounds/video-output-E1E478D7-8EF9-4800-9467-5685FCF4DD36.mp3"
  loop
></audio>

<script>
const engine = document.getElementById("engine");
const pedal = document.getElementById("pedal");
const rpmText = document.getElementById("rpm");

let rpm = 800;
let accel = false;
let started = false;

// 最初のタップで再生開始（以後止めない）
function start(){
  if(started) return;
  engine.volume = 0.9;
  engine.playbackRate = 0.9;
  engine.play();
  started = true;
}

function press(){
  start();
  accel = true;
}

function release(){
  accel = false;
}

pedal.addEventListener("touchstart", press);
pedal.addEventListener("mousedown", press);
pedal.addEventListener("touchend", release);
pedal.addEventListener("mouseup", release);

// 実車寄せ：ゆっくり重く変化
setInterval(()=>{
  if(accel){
    rpm += 55;          // 重たい上がり
    if(rpm > 4500) rpm = 4500;
  }else{
    rpm -= 85;          // 粘って落ちる
    if(rpm < 800) rpm = 800;
  }

  // ピッチは安全範囲のみ
  const targetRate = 0.85 + (rpm / 6000) * 0.2; // max ~1.05
  engine.playbackRate += (targetRate - engine.playbackRate) * 0.12;

  rpmText.textContent = "RPM: " + rpm;
}, 60);
</script>

</body>
</html>
