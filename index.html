<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>RX-7 FD Asphalt Drive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #111;
  font-family: system-ui;
}

/* ===== アスファルト地面 ===== */
#road {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 45%;
  background:
    repeating-linear-gradient(
      to bottom,
      #2b2b2b 0px,
      #2b2b2b 6px,
      #262626 6px,
      #262626 12px
    );
  box-shadow: inset 0 10px 40px rgba(0,0,0,0.8);
  z-index: 0;
}

/* 路面の粒感 */
#road::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image:
    radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 4px 4px;
  opacity: 0.4;
}

/* ===== HUD ===== */
#hud {
  position: absolute;
  top: 10px;
  right: 14px;
  color: #7CFF00;
  z-index: 10;
  text-align: right;
}
#speed {
  font-size: 34px;
  font-weight: bold;
}

/* ===== 操作UI ===== */
#ui {
  position: absolute;
  bottom: 20px;
  width: 100%;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  padding: 0 10px;
  z-index: 10;
}

button {
  padding: 16px 0;
  font-size: 16px;
  background: #111;
  color: #7CFF00;
  border: 2px solid #7CFF00;
  border-radius: 8px;
}
button:active {
  background: #7CFF00;
  color: black;
}

/* ===== 3D ===== */
model-viewer {
  width: 100vw;
  height: 100vh;
  background: transparent;
  z-index: 2;
}
</style>
</head>

<body>

<div id="road"></div>

<div id="hud">
  SPEED<br>
  <div id="speed">0</div>
  km/h
</div>

<model-viewer
  id="car"
  src="scene.glb"
  camera-controls
  exposure="1.1"
  shadow-intensity="1">
</model-viewer>

<div id="ui">
  <button id="left">LEFT</button>
  <button id="accel">ACCEL</button>
  <button id="brake">BRAKE</button>
  <button id="right">RIGHT</button>
</div>

<script>
const car = document.getElementById("car");
const road = document.getElementById("road");
const speedEl = document.getElementById("speed");

let speed = 0;
let targetSpeed = 0;
let steer = 0;
let targetSteer = 0;

let pitch = 0;
let roll = 0;
let yaw = 0;
let roadOffset = 0;

/* 入力 */
function bind(id, down, up){
  const b = document.getElementById(id);
  b.ontouchstart = b.onmousedown = down;
  b.ontouchend = b.onmouseup = up;
}
bind("accel", ()=>targetSpeed=1, ()=>targetSpeed=0);
bind("brake", ()=>targetSpeed=-1, ()=>targetSpeed=0);
bind("left",  ()=>targetSteer=-1, ()=>targetSteer=0);
bind("right", ()=>targetSteer=1, ()=>targetSteer=0);

/* メインループ */
function update(){
  // スピード
  speed += (targetSpeed - speed) * 0.06;
  speed = Math.max(0, Math.min(speed, 1));

  // ステア
  steer += (targetSteer - steer) * 0.15;

  // 表示
  speedEl.textContent = (speed * 180).toFixed(0);

  // 車体挙動
  pitch += ((-speed * 7) - pitch) * 0.15;
  roll  += ((-steer * speed * 9) - roll) * 0.15;
  yaw   += steer * speed * 0.4;

  // 振動
  const shake =
    Math.sin(Date.now() * 0.03) * speed * 0.35;

  car.style.transform = `
    translateY(${shake}px)
    rotateX(${pitch}deg)
    rotateY(${yaw}deg)
    rotateZ(${roll}deg)
  `;

  // アスファルトを前に流す（縦方向）
  roadOffset += speed * 16;
  road.style.backgroundPositionY = `${roadOffset}px`;

  requestAnimationFrame(update);
}
update();
</script>

</body>
</html>
